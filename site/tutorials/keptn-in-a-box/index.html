
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>🎁 Keptn in a Box</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-133584243-1"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="keptn-in-a-box"
                  title="🎁 Keptn in a Box"
                  environment="web"
                  feedback-link="https://github.com/keptn/tutorials/tree/master/site/tutorials">
    
      <google-codelab-step label="Welcome" duration="2">
        <p>In this turorial you&#39;ll learn how to run and customize <a href="https://github.com/keptn-sandbox/keptn-in-a-box" target="_blank">Keptn-in-a-Box</a>. Keptn-In-A-Box is a Bash script that will convert a plain Ubuntu machine in a Single Node Kubernetes Cluster with Keptn installed and configured (among other cool features which will set sail for your autonomous cloud journey). The script is programmed in a modular way so you can select the 🧩 <strong>installationBundle</strong> that better suits your needs.</p>
<p><em>Keptn-in-a-Box is a 🚀 rocket launcher for enabling tutorials or workshops in an easy, fast and ressource efficient way.</em></p>
<p>In a matter of minutes you&#39;ll have a fully configured <strong>Single Node Kubernetes Cluster</strong> for learning <a href="https://tutorials.keptn.sh" target="_blank">Keptn tutorials</a>, trying out new functionalities, building your own pipeline or even delivering <strong>Performance-as-a-Self-Service</strong>.</p>
<p><a href="https://github.com/keptn-sandbox/keptn-in-a-box" target="_blank">Keptn-in-a-Box</a> runs on <a href="https://microk8s.io/" target="_blank">microk8s</a>, which is a simple production-grade upstream certified Kubernetes made for developers and DevOps.</p>
<p>The mantra behind Keptn-In-A-Box is that you</p>
<aside class="special"><p>Spend <strong>more</strong> time <strong>innovating</strong> 😄⚗️ and <em>less</em> time <em>configuring</em> 😣🛠</p>
</aside>
<p class="image-container"><img alt="keptn-in-a-box" src="img/5148752cd325c74f.png"></p>
<p><em>You can actually just run the program without any customization, but let&#39;s take the time to understand what Keptn-in-a-Box does for you and how you can customize the installation.</em></p>
<h2 class="checklist" is-upgraded>What you&#39;ll learn</h2>
<ul class="checklist">
<li>What are the requirements needed</li>
<li>How to customize Keptn-in-a-Box</li>
<li>How to run Keptn-in-a-Box</li>
<li>How to access the configured services</li>
<li>How to troubleshoot in case of troubles</li>
</ul>
<aside class="special"><p>⏰ This tutorial is dynamic, meaning the time calculated depends on the customization you provide. The most common customizations are reflected in its own steps. As you go along on this tutorial you&#39;ll find <code>required</code> ●, <code>recommended</code>⦿ and <code>optional</code>○ steps which you&#39;ll be able to skip if not desired.</p>
</aside>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p>Required</p>
</td><td colspan="1" rowspan="1"><p>●</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Recommended</p>
</td><td colspan="1" rowspan="1"><p>⦿</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Optional</p>
</td><td colspan="1" rowspan="1"><p>○</p>
</td></tr>
</table>


      </google-codelab-step>
    
      <google-codelab-step label="● Get your Ubuntu box" duration="3">
        <h2 is-upgraded>Prerequisite</h2>
<p>The only prerequisite for Keptn-in-a-Box is that you get an Ubuntu machine and that it has an internet connection. This can be a VirtualMachine running in your datacenter, on your laptop or in a cloud provider such as Microsoft Azure, Amazon Web Services, Google Cloud among others.<br>The tested distributions are  <strong>Ubuntu Server 18.04 LTS &amp; 20.04 LTS</strong></p>
<h3 is-upgraded>☁️Get a cloud VM</h3>
<p>Don&#39;t have a VM or a Cloud Account? Don&#39;t worry, here you can sign for a free tier in:</p>
<ul>
<li><a href="https://aws.amazon.com/free/" target="_blank">Amazon Web Services</a></li>
<li><a href="https://azure.microsoft.com/en-us/free/" target="_blank">Microsoft Azure</a></li>
<li><a href="https://cloud.google.com/free" target="_blank">Google Cloud</a></li>
</ul>
<h3 is-upgraded>💻Get a local VM</h3>
<p>Want to try it locally? Not a problem. Check out <a href="https://multipass.run/" target="_blank">multipass</a>! a great way for spinning instant Ubuntu VMs in Windows, Mac or Linux computers.</p>
<h2 is-upgraded>📏Sizing</h2>
<p>For most usecases we recommend <code>4 Cores</code>, <code>16 Gigs of RAM</code> and <code>20 Gigs of diskspace</code>. Our tests have shown that the minimum required for running Keptn-in-a-Box with all <code>installationBundles</code> is a t2.medium (2 vCPU and 4 Gib of RAM) and 10 Gigabytes of disk space. Nevertheless this won&#39;t leave much space for spinning other services or onboarding applications.</p>
<p>For the ultimate experience you could get a <code>t2.2xlarge</code> with 8 Cores, 32 Gigs of RAM and 20 Gigs of diskspace.</p>
<h2 is-upgraded>AWS sizings for reference</h2>
<p>Below is a table for the sizing reference.</p>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p>-</p>
</td><td colspan="1" rowspan="1"><p><strong>Size</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>vCPUs</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>Memory (GiB)</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>😓</p>
</td><td colspan="1" rowspan="1"><p>t2.medium</p>
</td><td colspan="1" rowspan="1"><p>2</p>
</td><td colspan="1" rowspan="1"><p>4</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>🙂</p>
</td><td colspan="1" rowspan="1"><p>t2.large</p>
</td><td colspan="1" rowspan="1"><p>2</p>
</td><td colspan="1" rowspan="1"><p>8</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>😊</p>
</td><td colspan="1" rowspan="1"><p>t2.xlarge</p>
</td><td colspan="1" rowspan="1"><p>4</p>
</td><td colspan="1" rowspan="1"><p>16</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>🤓</p>
</td><td colspan="1" rowspan="1"><p>t2.2xlarge</p>
</td><td colspan="1" rowspan="1"><p>8</p>
</td><td colspan="1" rowspan="1"><p>32</p>
</td></tr>
</table>
<h2 is-upgraded>☎️ Open ports</h2>
<p>If you define security rules in the Cloud provider or on your datacenter, your instance only needs to have the following pports accessible:</p>
<ul>
<li>22  / SSH</li>
<li>80  / HTTP</li>
<li>443 / HTTPS</li>
</ul>
<h2 is-upgraded>Other considerations</h2>
<aside class="special"><p>The functions for Keptn-in-a-Box were developed under Ubuntu but this does not mean it won&#39;t work for other Operative systems such as CentOS, Fedora, openSuse, etc... If you are willing to try it out, we would love to hear the results. Just bear in mind that the installation of Microk8s depends on <a href="https://snapcraft.io/" target="_blank">Snapcraft package manager</a>.</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="● Login to your Ubuntu box" duration="0">
        <h2 is-upgraded>💻 Login to your Ubuntu</h2>
<p>When your Ubuntu machine is up and running, let&#39;s log in into it.</p>
<pre><code>ssh yourusername@the-bind-ip-or-dns
</code></pre>
<h2 is-upgraded>Download <code>keptn-in-a-box.sh</code></h2>
<p>Now let&#39;s download the <code>keptn-in-a-box.sh</code> file and make it executable.</p>
<pre><code>curl -O https://raw.githubusercontent.com/keptn-sandbox/keptn-in-a-box/master/keptn-in-a-box.sh
chmod +x keptn-in-a-box.sh
</code></pre>
<aside class="special"><p>Any 🎨customization will take place in the <code>keptn-in-a-box.sh</code> file you just downloaded.</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="⦿ Configure Dynatrace" duration="1">
        <p>By <strong>only</strong> providing your Dynatrace credentials, Keptn-in-a-Box will:</p>
<ul>
<li>Install the OneAgent via the <a href="https://www.dynatrace.com/support/help/technology-support/cloud-platforms/kubernetes/monitoring/monitor-workloads-kubernetes/" target="_blank">OneAgent Operator</a> for the Cluster and configure the Dynatrace Integration for Keptn.</li>
<li>Configure the Dynatrace Service in Keptn.</li>
<li>Download and configure the <a href="https://www.dynatrace.com/support/help/technology-support/cloud-platforms/kubernetes/oneagent-with-helm/" target="_blank">Dynatrace ActiveGate</a> for monitoring the <a href="https://www.dynatrace.com/support/help/technology-support/cloud-platforms/kubernetes/monitoring/monitor-kubernetes-openshift-clusters/" target="_blank">Kubernetes Cluster Utilization</a>, <a href="https://www.dynatrace.com/support/help/technology-support/cloud-platforms/kubernetes/monitoring/events/" target="_blank">Kubernetes Events</a> and <a href="https://www.dynatrace.com/support/help/technology-support/cloud-platforms/kubernetes/monitoring/monitor-workloads-kubernetes/" target="_blank">Workloads</a>.</li>
</ul>
<aside class="special"><p>You have to bring your own Dynatrace tenant</p>
</aside>
<p>If you don&#39;t have a Dynatrace tenant yet, sign up for a <a href="https://www.dynatrace.com/trial/" target="_blank">free trial</a> or a <a href="https://www.dynatrace.com/developer/" target="_blank">developer account</a>.</p>
<aside class="warning"><p>If you don&#39;t want to empower your Box with Dynatrace, skip to <a href="./#5" target="_self">Configure your Domain</a></p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="⦿ Get and enter Dynatrace credentials" duration="6">
        <h2 is-upgraded>Create a Dynatrace API Token</h2>
<p>Log in to your Dynatrace tenant and go to <strong>Settings &gt; Integration &gt; Dynatrace API</strong>. Then, create anew API token with the following permissions</p>
<ul>
<li>Access problem and event feed, metrics and topology</li>
<li>Access logs</li>
<li>Configure maintenance windows</li>
<li>Read configuration</li>
<li>Write configuration</li>
<li>Capture request data</li>
<li>Real user monitoring JavaScript tag managemen<br><br></li>
</ul>
<p>Take a look at this screenshot to double check the right token permissions for you.<br><img alt="Dynatrace API Token" src="img/fcfacc636efc4a19.png"></p>
<h2 is-upgraded>Create a Dynatrace PaaS Token</h2>
<p>In your Dynatrace tenant, go to <strong>Settings &gt; Integration &gt; Platform as a Service</strong>, and create a new PaaS Token.</p>
<h2 is-upgraded>Enter your Dynatrace Credentials</h2>
<p>Now that you have an API-Token and a PaaS-Token, we can enter the credentials.<br>In the <code>keptn-in-a-box.sh</code> file enter your credentials under the section &#34;Define Dynatrace Environment&#34;.</p>
<pre><code># ---- Define Dynatrace Environment ---- 
# Sample: https://{your-domain}/e/{your-environment-id} for managed or https://{your-environment-id}.live.dynatrace.com for SaaS
TENANT=&#34;https://mytenant.live.dynatrace.com&#34;
PAASTOKEN=&#34;myDynatracePaaSToken&#34;
APITOKEN=&#34;myDynatraceApiToken&#34;
</code></pre>
<p>That&#39;s it! When you run the program, it will detect that you enter your credentials and will download and configure Dynatrace for you.</p>
<aside class="warning"><p>Be sure that the Box is reachable by your Dynatrace environment and vice versa.</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="○ Configure your Domain" duration="4">
        <h2 is-upgraded>Default configuration (public IP)</h2>
<p>By default Keptn-in-a-Box will <code>curl ifconfig.me</code>  to get the public ip where it&#39;s running and will convert the IP into a magic 🧙‍♂️ domain with <a href="nip.io" target="_blank">nip.io</a>. For example if your Box is public accessible over the IP <code>116.203.255.68</code> it will convert it to <code>116-203-255-68.nip.io</code>. NIP.IO is Dead simple wildcard DNS resolution for any IP Address.</p>
<aside class="special"><p>Having a magic domain allows you to access as much services as you want with the help of 🎡Kubernetes and Istio ⛵️. The kubernetes services will be defined as subdomains (or virtual Hosts) and resolved inside your K8s via either Istio Virtual Services or Ingresses.</p>
</aside>
<p>✅ If your box has a public ip, you can go with the <strong>defaults</strong> and leave the <code>DOMAIN</code> variable <strong>empty</strong>.</p>
<h2 is-upgraded>Configuration for an internal IP</h2>
<aside class="warning"><p>If your box does <strong>not</strong> have a public ip, you&#39;ll have to configure the domain so you can access the services from outside the box.<br></p>
</aside>
<p>For example I want to run Keptn-in-a-Box inside my Home Network and the VM get&#39;s the IP <code>192.168.0.10</code>. I will convert the IP to a magic domain. This way the requests to any subdomain, for example to <a href="https://api.keptn.192.168.0.10.nip.io" target="_blank">https://api.keptn.192.168.0.10.nip.io</a> will get resolved to <code>192.168.0.10</code> and then kubernetes will take care of forwarding the request internally to the Keptn API service.</p>
<p>Just enter the IP in a magic domain notation as shown below. The ip can contain dashes (-) or dots (.). I just like dashes more, they are prettier 💄.</p>
<pre><code># ---- Define your Domain ----   
DOMAIN=&#34;192-168-0-10.nip.io&#34;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="○ Create a workshop user account" duration="1">
        <p>👨‍💻 If you want to give access to a person, this sections shows you how to enable it.</p>


      </google-codelab-step>
    
      <google-codelab-step label="● Select the installation Bundle" duration="1">
        <p>Explain how to override single flags, check he installer file</p>


      </google-codelab-step>
    
      <google-codelab-step label="● Execute the script" duration="7">
        <p>the User to run the commands</p>


      </google-codelab-step>
    
      <google-codelab-step label="Access your services" duration="5">
        <p>Print the services</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>

</body>
</html>
